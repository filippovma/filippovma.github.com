
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Mikhail Filippov's Blog</title>
  <meta name="author" content="Mikhail Filippov">

  
  <meta name="description" content="
">
  
  <meta name='yandex-verification' content='61921a770a854546' />
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.filippov.me/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Mikhail Filippov's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32711941-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Mikhail Filippov's Blog</a></h1>
  
    <h2>My personal blog.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.filippov.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/15/how-to-setup-webdeploy-on-iis-for-visual-studio-publishing/">How to Setup WebDeploy on IIS for Visual Studio Publishing.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-15T16:29:00+04:00" pubdate data-updated="true">Mar 15<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content">
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/15/how-to-upload-big-media-file-in-umbraco/">Загрузка больших файлов в Media для Umbraco CMS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-15T19:09:00+04:00" pubdate data-updated="true">Feb 15<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="#webconfig">Перейти к готовому примеру web.config</a></p>

<p>Недавно столкнулся со с проблемой в Umbraco CMS. С настройками по умолчанию не получалось загружать файлы больше 30Мб. Причем выглядит это крайне странно полоска загрузки файл пробегает окно загрузки закрывается, при этом файл не появляется. При это никаких ошибок не возникает. Обычно проблемы с загрузкой больших файлов решается установкой в web.config настройки максимальной длины запроса:</p>

<figure class='code'><figcaption><span>web.config </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;httpRuntime</span> <span class="na">requestValidationMode=</span><span class="s">&quot;2.0&quot;</span> <span class="na">maxRequestLength=</span><span class="s">&quot;1024000&quot;</span> <span class="na">executionTimeout=</span><span class="s">&quot;3600&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Но это не помогло.</p>

<p>Попытаемся разобраться в чем же дело. Для начала посмотрим что происходит при загрузке файла. Для этого запустим Fiddler и попытаемся проанализировать весь процесс.</p>

<ul>
<li>Нажимаем кнопку загрузить файл:
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/1.png" alt="Нажимаем загрузить файл" /></li>
<li>Выбираем файл и нажимаем кнопку Upload:
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/2.png" alt="Выбираем файл" /></li>
<li>Видим что пошла нормальная загрузка:
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/3.png" alt="Пошла загрузка" /></li>
<li>После окончания загрузки окно закрывается без ошибок и предупреждений но файл на появляется.
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/4.png" alt="Файл не появился" /></li>
<li>Откроем окно загрузки повторно:
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/5.png" alt="Повторное октрытие" /></li>
<li>Тут мы видим что полоска загрузки красная похоже произошла какая-то ошибка. Посмотрим что в этот момент происходило в Fiddler. Происходит странное, в момент обращения к обработчику MediaUploader.ashx выдается ошибка 404, при этом в случае загрузки небольшого файла такого не происходит.
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/6.png" alt="Повторное октрытие" /></li>
<li>После долгих поисков я нашел параметр который отвечает за настройку фильтрации максимальному размеру поля Content-Legth в запросе. Для его изменения открываем IIS Manager(Его можно поменять и из web.config как я опишу ниже). Открывает настройки нашего сайта и выбираем &#8220;Request Filtering&#8221;:
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/7.png" alt="ISS Manager" /></li>
<li>На панели действий выбираем &#8220;Edit Feature Settings…&#8221;:
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/8.png" alt="Edit Feature Settings" /></li>
<li>Меняем значение поля Maximum allowed content length на большее например дописываем пару нулей :), обратите внимание что размер значения в байтах:
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/9.png" alt="Change Settings" /></li>
<li>В web.config проверяем что в httpRuntime стоит правильно значение maxRequestLength <strong>без этого работать не будет!</strong></li>
<li>Пробуем повторно загрузить файл:
<img src="/images/2013-02-15-how-to-upload-big-media-file-in-umbraco/10.png" alt="Change Settings" /></li>
<li>Все работает корректно</li>
</ul>


<h2><a id="webconfig"></a>Чтобы все это настроить без IIS Manager</h2>

<p>В секции  system.web и system.webServer файла web.config нужно добавить следующие параметры (ограничение размера 1Гб):</p>

<figure class='code'><figcaption><span>web.config</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>  <span class="nt">&lt;system.web&gt;</span>
</span><span class='line'>      <span class="nt">&lt;httpRuntime</span> <span class="na">requestValidationMode=</span><span class="s">&quot;2.0&quot;</span> <span class="na">maxRequestLength=</span><span class="s">&quot;1024000&quot;</span> <span class="na">executionTimeout=</span><span class="s">&quot;3600&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/system.web&gt;</span>
</span><span class='line'>  <span class="nt">&lt;system.webServer&gt;</span>
</span><span class='line'>      <span class="nt">&lt;security&gt;</span>
</span><span class='line'>      <span class="nt">&lt;requestFiltering&gt;</span>
</span><span class='line'>          <span class="nt">&lt;requestLimits</span> <span class="na">maxAllowedContentLength=</span><span class="s">&quot;1024000000&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/requestFiltering&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/security&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/system.webServer&gt;</span>
</span><span class='line'><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/01/how-to-open-vhd-vm-in-parallels-desktop/">Как открыть VHD образ виртуальной машины в Parallels Desktop 8</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-01T15:18:00+04:00" pubdate data-updated="true">Feb 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Я часто сталкиваюсь с необходимостью развертывания различных виртуальных машин на своем ноутбуке. В этом мне всегда помогает Parallels Desktop 8. Это хороший продукт, который очень тесно интегрирован в мою основную ОС Mac OS X. Отдельные типа виртуальных машин PD8 умеет конвертировать при открытии, то есть достаточно выполнить комманду File->Open и выбрать файл с настройками виртуальной машины. Этот способ работает для VMWare и VirtualBox, когда у вас есть файл с настройками машины.</p>

<p>Недавно мне понадобилось развернуть несколько триальных версий Windows Server 2012 для тестирования. Ставить их из ISO образов очень не хотелось. Благо у Microsoft доступны готовые предустановленные образы виртуальных машин в формате VHD. Только вот незадача PD8 никак не хотел делать из такого образа машину. Немного погуглив я нашел способ как это сделать.</p>

<p>Для начала скачаем файл образ машины: <em>9200.16384.amd64fre.win8_rtm.120725-1247_server_serverstandardeval_en-us.vhd</em>.</p>

<p>Кладем его в отдельную папку и рядом с ним создаем файл: &#8220;Windows Server 2012.vmc&#8221; со следующем содержимым:</p>

<figure class='code'><figcaption><span>Windows Server 2012.vmc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'>  <span class="nt">&lt;preferences&gt;</span>
</span><span class='line'>      <span class="nt">&lt;version</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>2.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>      <span class="nt">&lt;hardware&gt;</span>
</span><span class='line'>          <span class="nt">&lt;pci_bus&gt;</span>
</span><span class='line'>              <span class="nt">&lt;ide_adapter&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;ide_controller</span> <span class="na">id=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                      <span class="nt">&lt;location</span> <span class="na">id=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                          <span class="nt">&lt;drive_type</span> <span class="na">type=</span><span class="s">&quot;integer&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/drive_type&gt;</span>
</span><span class='line'>                          <span class="nt">&lt;pathname&gt;</span>
</span><span class='line'>                              <span class="nt">&lt;absolute</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>/Path-To-VHD-Folder/9200.16384.amd64fre.win8_rtm.120725-1247_server_serverstandardeval_en-us.vhd<span class="nt">&lt;/absolute&gt;</span>
</span><span class='line'>                              <span class="nt">&lt;relative</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>9200.16384.amd64fre.win8_rtm.120725-1247_server_serverstandardeval_en-us.vhd<span class="nt">&lt;/relative&gt;</span>
</span><span class='line'>                          <span class="nt">&lt;/pathname&gt;</span>
</span><span class='line'>                      <span class="nt">&lt;/location&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;/ide_controller&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/ide_adapter&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/pci_bus&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/hardware&gt;</span>
</span><span class='line'><span class="nt">&lt;/preferences&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Теперь открываем этот файл в PD8 File->Open:</p>

<p><img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/1.png" alt="Открываем файл" /></p>

<p>PD8 предложит конвертировать машину:</p>

<p><img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/2.png" alt="Начало конвертации" /></p>

<p>Указываем папку куда положить конвертированную машину и запускаем процесс:</p>

<p><img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/3.png" alt="Процесс конвертации" /></p>

<p>После завершения конвертиции можно сразу запустить машину. Но мне необходимо запустить несколько таких машин, по этому превращу машину в шаблон. Когда после конвертации PD8 спросит нужно ли запустить машину для завершения конвертации выбираем No.</p>

<p><img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/4.png" alt="No" /></p>

<p>Выбираем File->Convert To Template:</p>

<p><img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/5.png" alt="Convert to template" /></p>

<p>После этого закрываем машину и у нас в списке машин появляется готовый шаблон. Делаем из этого шаблона рабочую машину:</p>

<p><img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/6.png" alt="Развертывание" />
<img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/7.png" alt="Куда развертывать" /></p>

<p>Теперь можно запустить развернутую машину она при этом продолжит конвертацию:</p>

<p><img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/8.png" alt="Продолжение конвертации" /></p>

<p>Через некоторое время машина попросит сделать дополнительные настройки:</p>

<p><img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/9.png" alt="Дополнительные настройки" /></p>

<p>Проходим шаги мастера настройки ОС и входим в систему. После этого автоматически установятся Parallels Tools машина перезагрузится и конвертация будет завершена.</p>

<p><img src="/images/2013-02-01-how-to-open-vhd-vm-in-parallels-desktop/10.png" alt="Завершение" /></p>

<p>Шаблон для Windows Server я специально сделал до первого запуска, потому что при этом у каждой виртуальной машины будет свой собственный SID и они смогут нормально работать в одном домене Active Directory. Если этого не сделать, а сразу запустить машину и довести конвертацию до конца, не получится ввести две виртуальных машины в один домен так как у них будут одинаковые SID.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/26/review-infobox-cloud/">Обзор облака из коробки.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-26T00:15:00+04:00" pubdate data-updated="true">Jan 26<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Последние несколько месяцев проходило тестирование облака от компании InfoBox. Хотелось бы поделится впечатлениями о данном решение.</p>

<p>Облако InfoBox построено на основе контейнерной виртуализации от компании Parallels. Есть возможность выбора контейнера как на основе Linux так и на основе Windows. В качестве Linux дистрибутива предлагается Debian 6.0 x86_64. В качестве Windows: Server 2008 R2.</p>

<p>Интерфейс управления облаком InfoBox выглядит достаточно не плохо и в целом позволяет быстро разобраться с ним даже не подготовленному пользователю. При создании машин есть 3 предопределенных профиля: Basic, Power и Mega. Вот пример настроек доступных при создании виртуальной машины:
<img src="/images/2013-01-26-review-infobox-cloud/1.png" alt="Создание виртуальной машины" />
Есть одна интересная особенность не забудьте выбрать пропускную способность. Шейпер у инфобокс работает очень хорошо, я сначала не понял почему так сильно тормозит сеть. Особенно это сильно заметно на RDP соединение у Windows машины. Эту настройку можно будет поменять после того как машина будет создана.</p>

<p>В работе с сетью есть несколько особенностей. Во первых у клиента есть возможность использовать как публичные так и приватные адреса. То есть вы можете создать приватную сетевую  инфраструктуру и сделать себе 1 точку входа в нее. Во вторых можно создать один или несколько преднастроенных балансировщиков нагрузки HTTP, которые можно сразу назначить на уже созданные сервера. Еще одно особенностью является то что исходящий траффик платный. Для тестирования производительности сети я установил на сервер SpeedTest Mini. Вот результат теста при том что в настройках сетевого подключения стоит ограничение 100 КБит/сек:</p>

<p><img src="/images/2013-01-26-review-infobox-cloud/2.png" alt="Тест сети 100КБит/сек" /></p>

<p>А вот при ограничение в 50МБит/сек:</p>

<p><img src="/images/2013-01-26-review-infobox-cloud/3.png" alt="Тест сети 50МБит/сек" /></p>

<p>Как видим полоса пропускания соответствует заявленной.
Из веб-интерфейса так же можно управлять настройками брандмауэра:
<img src="/images/2013-01-26-review-infobox-cloud/4.png" alt="Создание правила брандмауэра" />
Чтобы оценить примерные затраты на использование облака, по каждому серверу можно просмотреть расход ресурсов и примерную стоимость:
<img src="/images/2013-01-26-review-infobox-cloud/5.png" alt="Расход ресурсов" />
Так же можно помотреть расход ресурсов по всей инфраструктуре в пункте &#8220;Использование всех ресурсов&#8221;:
<img src="/images/2013-01-26-review-infobox-cloud/6.png" alt="Использование всех ресурсов" />
На учетной записи есть общие лимиты которые действуют суммарно на всю инфраструктуру их можно просмотреть в пункте меню &#8220;Ресурсы подписки&#8221;:
<img src="/images/2013-01-26-review-infobox-cloud/7.png" alt="Ресурсы подписки" />
Из веб-панели всегда можно сбросить пароль для доступа к машине при этом новый пароль Вам вышлют на почту на которую зарегистрирован аккаунт.</p>

<p>Отдельно хочется отметить достаточно удобный функционал резервного копирования машин по расписанию &#8220;Ежедневно&#8221; и &#8220;Еженедельно&#8221;. Из минусов не нашел как выгрузить резервные копии на свой внешний ресурс и нет возможности восстановить резервную копию в отдельную машину, чтобы была возможность достать срез данных на определенный момент.
Доступна функциональность создания образа сервера, который в дальнейшем можно использовать как шаблон для запуска новых серверов, очень удобная вещь для массового развертывания приложений.</p>

<p>Для автоматизации облака доступен API <a href="http://download.pa.parallels.com/poa/5.4/doc/pdf/POA%20RESTful%20API%20Guide/paci-restful-api-guide-5.4.pdf">PACI</a> с помощью удобного REST интерфейса вы можете написать различные скрипты автоматизации работы облака.</p>

<p>Из общих моментов InfoBox так же предлагает дополнтельный услуги такие как управление и регистрация доменов и SSL-сертификаты.
По итогам тестирования особых проблем с работой облака я не заметил. Иногда были некоторые подтормаживания веб-интерфейса управления, но в целом все работает не плохо. Еще из минусов не нашел возможности делегирования управления на дополнительные учетные записи например если у вас в компании несколько системных администраторов и вы бы хотели делегировать управление частью сервером им, все работает под одной учетной записью, но я думаю при производственном внедрении InfoBox сможет решить эту проблемы. Отдельно хотелось бы заметить наличие контейнеров с Windows Server, я их пробывал в первый раз, оказалось вполне достойное решение.</p>

<p>Вы можете сами все это потрогать достаточно пройти по адресу <a href="http://www.infobox.ru/cloud/servers/">http://www.infobox.ru/cloud/servers/</a> и заказать себе тестовый доступ, там же вы можете получить дополнительную информацию и задать свои вопросы онлайн-консультанту.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/08/unit-testing-with-microsoft-fakes/">Тестирование с помощью Microsoft Fakes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-08T10:39:00+04:00" pubdate data-updated="true">Jul 8<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>В Visual Studio 2012 получил развитие один из продуктов Microsoft Researсh известный под именем Moles. Это mock-фреймворк для облегчения написания юнит-тестов. Моки это специальные объекты заглушки, с помощью которых в реализуют части функциональности приложения, которые необходимы тестируемому методу. Это дает возможность тестировать только логику метода определив статическую логику для его зависимостей.</p>

<p>В .NET существует популярный mock-фреймвок: <a href="http://code.google.com/p/moq/">Moq</a>, но он не позволяет мокировать статические методы. Это является достаточно серьезной проблемой, когда вы тестируете код который зависит к примеру от текущей даты или файловой системы. Проблема заключается в следующем. Предположим у Вас есть код который регистрирует время входа пользователя в систему:</p>

<figure class='code'><figcaption><span>AccountManager.cs</span><a href='http://blog.filippov.me/blog/2012/08/07/unit-testing-with-microsoft-fakes/'>Ссылка на статью</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">AccountManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">_logs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">SignIn</span><span class="p">(</span><span class="kt">string</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_logs</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">,</span> <span class="s">&quot;{0} {1} Sign In&quot;</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">,</span> <span class="n">user</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="n">IList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">GetLogs</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">_logs</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Напишем тест на метод SignIn:</p>

<figure class='code'><figcaption><span>AccountManagerTests.cs</span><a href='http://blog.filippov.me/blog/2012/08/07/unit-testing-with-microsoft-fakes/'>Ссылка на статью</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="na">[TestClass]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">AccountManagerTests</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [TestMethod]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">ShouldBeCorrectLogRecordAfterSignIn</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">mgr</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AccountManager</span><span class="p">();</span>
</span><span class='line'>        <span class="n">mgr</span><span class="p">.</span><span class="n">SignIn</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;02/03/2001 01:02:03 user1 SignIn&quot;</span><span class="p">,</span> <span class="n">mgr</span><span class="p">.</span><span class="n">GetLogs</span><span class="p">().</span><span class="n">Last</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Здесь мы сталкиваемся с проблемой тест не проходит потому, что в коде функции используется статическое свойство DateTime.Now, которое всегда выдает текущую дату и время и нет способа указать ей что надо возвращать какое-то предопределенное значение.</p>

<p>До появления Fakes можно было поступить так. Сделать хелпер класс который бы отвечал за обертывание вызова DateTime.Now и передать его в конструктор объекта.</p>

<p>Рассмотрим какие возможности предоставляет нам Microsoft Fakes. В Fakes существует два способа мокирования объектов: Stub и Shim. Они имееют разную реализацию и используются для решения различных типов задач.</p>

<ol>
<li><p>Stubs предназначены для мокирования интерфейсов и виртуальных методов не sealed классов. Эту функциональность предоставляют и другие тестовые фреймворки и работает достаточно быстро, потому что основанна на наследовании.</p></li>
<li><p>Shims предназначены для мокирования статических, не переопределяемых методов, а также встроенных системных типов. Эта функциональность уникальна для Fakes и позволяет избежать создания множества оберток для сокрытия системных типов. Shims основаны на перезаписи кода в рантайме, и работают достаточно медленно. Давайте посмотрим как использовать обе эти технологии.</p></li>
</ol>


<p>Для начала рассмотрим Stubs. Продолжим предыдущий пример. Для выноса из класса AccountManager зависимости DateTime, создадим новый интерфейс IDateTime, который будет определять 1 метод Now(), возвращающий текущую дату и время:</p>

<figure class='code'><figcaption><span>IDateTime.cs</span><a href='http://blog.filippov.me/blog/2012/08/07/unit-testing-with-microsoft-fakes/'>Ссылка на статью</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IDateTime</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">DateTime</span> <span class="nf">Now</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Добавим в основной проект его реализацию:</p>

<figure class='code'><figcaption><span>DateTimeHelper.cs</span><a href='http://blog.filippov.me/blog/2012/08/07/unit-testing-with-microsoft-fakes/'>Ссылка на статью</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">DateTimeHelper</span> <span class="p">:</span> <span class="n">IDateTime</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">DateTime</span> <span class="nf">Now</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Изменим AccountManager так, чтобы он принимал реализацию интерфейса в конструкторе и использовал её для получения текущего времени:</p>

<figure class='code'><figcaption><span>AccountManager.cs</span><a href='http://blog.filippov.me/blog/2012/08/07/unit-testing-with-microsoft-fakes/'>Ссылка на статью</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">AccountManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">readonly</span> <span class="n">IDateTime</span> <span class="n">_dateTime</span><span class="p">;</span>
</span><span class='line'>    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">_logs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="nf">AccountManager</span><span class="p">(</span><span class="n">IDateTime</span> <span class="n">dateTime</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_dateTime</span> <span class="p">=</span> <span class="n">dateTime</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">SignIn</span><span class="p">(</span><span class="kt">string</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_logs</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">,</span> <span class="s">&quot;{0} {1} Sign In&quot;</span><span class="p">,</span>
</span><span class='line'>                                <span class="n">_dateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">(),</span> <span class="n">user</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="n">IList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">GetLogs</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">_logs</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Теперь перепишем тест с использованием Stubs, для этого для начала нужно сгенерировать Stubs. Нажмем правой кнопкой на сборку к которой мы хотим получить Stub. И выберем: Add Fakes Assembly.</p>

<p><img src="/images/2012-08-07-unit-testing-with-microsoft-fakes/img1.png" alt="How to generate Stubs." /></p>

<p>После этого у нас появятся сгенерированные Stubs для всех классов сборки. И файл с расширением .fakes с настройками кодогенерации. Теперь в тесте мы можем использовать сгенерированный Stub.</p>

<figure class='code'><figcaption><span>AccountManagerTests.cs</span><a href='http://blog.filippov.me/blog/2012/08/07/unit-testing-with-microsoft-fakes/'>Ссылка на статью</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="na">[TestClass]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">AccountManagerTests</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [TestMethod]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">ShouldBeCorrectLogRecordAfterSignIn</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">stub</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StubIDateTime</span> <span class="p">{</span> <span class="n">Now</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span>
</span><span class='line'>
</span><span class='line'>                    <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">2001</span><span class="p">,</span> <span class="m">02</span><span class="p">,</span> <span class="m">03</span><span class="p">,</span> <span class="m">01</span><span class="p">,</span> <span class="m">02</span><span class="p">,</span> <span class="m">03</span><span class="p">,</span> <span class="n">DateTimeKind</span><span class="p">.</span><span class="n">Local</span><span class="p">)</span> <span class="p">};</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">mgr</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AccountManager</span><span class="p">(</span><span class="n">stub</span><span class="p">);</span>
</span><span class='line'>        <span class="n">mgr</span><span class="p">.</span><span class="n">SignIn</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;02/03/2001 01:02:03 user1 Sign In&quot;</span><span class="p">,</span> <span class="n">mgr</span><span class="p">.</span><span class="n">GetLogs</span><span class="p">().</span><span class="n">Last</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Запустим тест и видим что он нормально проходит.
Stub так же можно использовать для мокирования свойств:</p>

<figure class='code'><figcaption><span>test.cs</span><a href='http://blog.filippov.me/blog/2012/08/07/unit-testing-with-microsoft-fakes/'>Ссылка на статью</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">interface</span> <span class="n">IMyInterface</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">Value</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">var</span> <span class="n">stub</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StubIMyInterface</span><span class="p">();</span>
</span><span class='line'><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
</span><span class='line'><span class="n">stub</span><span class="p">.</span><span class="n">ValueGet</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'><span class="n">stub</span><span class="p">.</span><span class="n">ValueSet</span> <span class="p">=</span> <span class="p">(</span><span class="k">value</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">i</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Дополнительную информацию о Stubs можно получить в <a href="http://msdn.microsoft.com/en-us/library/hh549174%28v=vs.110%29.aspx">MSDN</a>.</p>

<p>Теперь рассмотрим Shims. В тестовом проекте интерфейс IDateTime служит исключительно для того чтобы была возможность подменить вызов DateTime.Now, давайте посмотрим как с этим справится Shim. Для начала удалим интерфейс и его реализацию, затем вернем на место вызов DateTime.Now.</p>

<figure class='code'><figcaption><span>AccountManager.cs</span><a href='http://blog.filippov.me/blog/2012/08/07/unit-testing-with-microsoft-fakes/'>Ссылка на статью</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">AccountManager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">_logs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">void</span> <span class="nf">SignIn</span><span class="p">(</span><span class="kt">string</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">_logs</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>                                 <span class="s">&quot;{0} {1} Sign In&quot;</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">,</span> <span class="n">user</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="n">IList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">GetLogs</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">_logs</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> Видим что тест перестал проходить. Теперь добавим в тест изменение поведения DateTime.Now с помощью Shims. Для начала сделаем Add Fakes Assembly для сборки System, это обеспечит генерацию Shim для класса DateTime, а за тем перепишем код теста:</p>

<figure class='code'><figcaption><span>AccountManagerTests.cs</span><a href='http://blog.filippov.me/blog/2012/08/07/unit-testing-with-microsoft-fakes/'>Ссылка на статью</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="na">[TestMethod]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">ShouldBeCorrectLogRecordAfterSignIn</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">using</span> <span class="p">(</span><span class="n">ShimsContext</span><span class="p">.</span><span class="n">Create</span><span class="p">())</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">ShimDateTime</span><span class="p">.</span><span class="n">NowGet</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span><span class="m">2001</span><span class="p">,</span> <span class="m">02</span><span class="p">,</span> <span class="m">03</span><span class="p">,</span> <span class="m">01</span><span class="p">,</span> <span class="m">02</span><span class="p">,</span> <span class="m">03</span><span class="p">,</span>
</span><span class='line'><span class="n">DateTimeKind</span><span class="p">.</span><span class="n">Local</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">mgr</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AccountManager</span><span class="p">();</span>
</span><span class='line'>        <span class="n">mgr</span><span class="p">.</span><span class="n">SignIn</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&quot;02/03/2001 01:02:03 user1 Sign In&quot;</span><span class="p">,</span> <span class="n">mgr</span><span class="p">.</span><span class="n">GetLogs</span><span class="p">().</span><span class="n">Last</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Запустим тест и видим, что он проходит. Shim позволяет подменять функциональность любых закрытых методов и избавляет нас от необходимости делать кучу ненужных оберток. Опишу подробнее, что происходит. Все вызовы к DateTime.Now внутри блока using (ShimsContext.Create()) будут перехвачены и подменены mock-объектом. Mock-контекст существует только в рамках этого блока. Дополнительно об использование Shims вы можете почитать в <a href="http://msdn.microsoft.com/en-us/library/hh549176%28v=vs.110%29.aspx">MSDN</a>.</p>

<p>Подведем итоги Microsoft Fakes представляет собой Mock-фреймворк интегрированный в Visual Studio 2012 и позволяющий сильно упростить написание тестов на платформе .NET.</p>

<p>P.S. Если кому-то интересны какие-то особенности Fakes пишите комментарии постораюсь ответить.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/03/15/how-to-setup-webdeploy-on-iis-for-visual-studio-publishing/">How to setup WebDeploy on IIS for Visual Studio publishing.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/15/how-to-upload-big-media-file-in-umbraco/">Загрузка больших файлов в Media для Umbraco CMS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/01/how-to-open-vhd-vm-in-parallels-desktop/">Как открыть VHD образ виртуальной машины в Parallels Desktop 8</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/26/review-infobox-cloud/">Обзор облака из коробки.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/08/unit-testing-with-microsoft-fakes/">Тестирование с помощью Microsoft Fakes</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/filippovma">@filippovma</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'filippovma',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("filippovma", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/filippovma" class="twitter-follow-button" data-show-count="false">Follow @filippovma</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/104415767739829768836?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Mikhail Filippov -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>


<!-- Yandex.Metrika counter -->
<script type="text/javascript">
(function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter19688374 = new Ya.Metrika({id:19688374, enableAll: true});
        } catch(e) {}
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f);
    } else { f(); }
})(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="//mc.yandex.ru/watch/19688374" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
 
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-filippov-me';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
